import requests
import openpyxl
import os
from docx import Document

file_path = ("C:\\Users\\Cinder\\OneDrive\\Documents\\Python Assignements\\MyMagicCardList.docx")

def search_items_in_docx(file_path, search_function):
    doc = Document(file_path)

    for para in doc.paragraphs:
        for card_name in para.text.split():
            search_function(card_name)


def search_function():
    card_name = search_items_in_docx(card_name, search_function)
    
    # Search for the card on Scryfall
    url = f"https://api.scryfall.com/cards/named?fuzzy={card_name}"
    response = requests.get(url)
    data = response.json()

    # Extracting relevant information
    name = data.get('name', '')
    colors = ', '.join(data.get('colors', [])) if data.get('colors') else ''
    card_url = data.get('scryfall_uri', '')

    # Check if the Excel file already exists
    file_name = "MyCardLibrary.xlsx"
    if not os.path.exists(file_name):
        wb = openpyxl.Workbook()
        ws = wb.active
        ws.title = "Card Data"
        ws.append(["Card Name", "Colors", "URL", "Count"])
    else:
        wb = openpyxl.load_workbook(file_name)
        ws = wb.active

    # Check if the card already exists in the file
    Count = 0
    for row in ws.iter_rows(min_row=2, max_row=ws.max_row, min_col=1, max_col=1):
        if row[0].value == name:
            Count = ws.cell(row=row[0].row, column=4).value
            ws.cell(row=row[0].row, column=4, value=Count + 1)
            break
    else:
        ws.append([name, colors, card_url, 1])

    # Save the Excel file
    wb.save(file_name)


